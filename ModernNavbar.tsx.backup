import { memo, useState, useEffect, useCallback } from 'react';
import {
	motion,
	AnimatePresence,
	useScroll,
	type Variants,
} from 'framer-motion';
import {
	Fab,
	Box,
	useScrollTrigger,
	Zoom,
	Backdrop,
	Chip,
	IconButton,
} from '@mui/material';
import {
	Description,
	Menu as MenuIcon,
	Close as CloseIcon,
	Home,
	Person,
	Code,
	Work,
	Science,
	School,
	ContactMail,
} from '@mui/icons-material';
import { useSystemProfile } from './useSystemProfile';
import FluidNavbar from './FluidNavbar';
import resumePDF from '../assets/Gading_Resume.pdf';

type NavItem = {
	name: string;
	href: string;
	icon: any;
};

type NavItemPosition = {
	x: number;
	width: number;
	height: number;
};

type NavItemPositions = Record<string, NavItemPosition>;

type InterpolationDatum = {
	section: string;
	visibilityRatio: number;
	index: number;
};

const ModernNavbarComponent = () => {
	const [isMenuOpen, setIsMenuOpen] = useState(false);
	const [activeSection, setActiveSection] = useState('hero');
	const [navItemPositions, setNavItemPositions] = useState<NavItemPositions>({});
	const [isMobileCSS, setIsMobileCSS] = useState(false);
	const [canRenderGlass, setCanRenderGlass] = useState(false);

	const navRef = useRef<HTMLDivElement | null>(null);

	const { performanceTier, deviceType } = useSystemProfile();

	const liquidX = useMotionValue(0);
	const liquidWidth = useMotionValue(0);
	const liquidOpacity = useMotionValue(0);

	const springX = useSpring(liquidX, {
		stiffness: 300,
		damping: 30,
		mass: 0.8,
	});
	const springWidth = useSpring(liquidWidth, {
		stiffness: 280,
		damping: 35,
		mass: 0.9,
	});
	const springOpacity = useSpring(liquidOpacity, {
		stiffness: 400,
		damping: 40,
	});

	const { scrollY, scrollYProgress } = useScroll({ layoutEffect: false });
	const trigger = useScrollTrigger({ disableHysteresis: true, threshold: 50 });

	const logoScale = useTransform(scrollY, [0, 100], [1, 0.9]);

	const isMobile = deviceType === 'mobile';
	const isTablet = deviceType === 'tablet';
	const shouldReduceMotion = performanceTier === 'low' || isMobile;

	useEffect(() => {
		if (typeof window === 'undefined') {
			return;
		}

		const checkMobile = () => {
			setIsMobileCSS(
				window.innerWidth <= 768 ||
					window.matchMedia('(pointer: coarse)').matches,
			);
		};

		checkMobile();
		window.addEventListener('resize', checkMobile);

		return () => {
			window.removeEventListener('resize', checkMobile);
		};
	}, []);

	useEffect(() => {
		setCanRenderGlass(true);
	}, []);

	const windowWidth = typeof window !== 'undefined' ? window.innerWidth : undefined;
	const isMobileDevice = isMobile || isMobileCSS;
	const isTabletDevice =
		isTablet ||
		(windowWidth !== undefined &&
			windowWidth > 768 &&
			windowWidth < 1024 &&
			(isMobile || isMobileCSS));

	const navItems = useMemo<NavItem[]>(
		() => [
			{ name: 'Home', href: '#hero', icon: Home },
			{ name: 'About', href: '#about', icon: Person },
			{ name: 'Tech', href: '#technologies', icon: Code },
			{ name: 'Experience', href: '#experience', icon: Work },
			{ name: 'Research', href: '#research', icon: Science },
			{ name: 'Projects', href: '#projects', icon: School },
			{ name: 'Certificates', href: '#certifications', icon: School },
			{ name: 'Contact', href: '#contact', icon: ContactMail },
		],
		[],
	);

	const getNavChipStyles = useCallback(
		(isActive: boolean) => {
			const accentGradient =
				'linear-gradient(135deg, rgba(99, 102, 241, 0.95) 0%, rgba(14, 165, 233, 0.92) 55%, rgba(59, 130, 246, 0.88) 100%)';
			const haloGradient =
				'linear-gradient(135deg, rgba(148, 163, 184, 0.4) 0%, rgba(99, 102, 241, 0.3) 50%, rgba(34, 211, 238, 0.28) 100%)';

			return {
				position: 'relative' as const,
				overflow: 'hidden',
				borderRadius: '999px',
				px: { xs: 1.4, sm: 2.2 },
				height: 44,
				minHeight: 44,
				color: isActive ? '#f8fafc' : '#e2e8f0',
				fontWeight: 700,
				letterSpacing: '0.16em',
				textTransform: 'uppercase',
				background: isActive ? accentGradient : 'rgba(15, 23, 42, 0.48)',
				border: '1px solid transparent',
				backdropFilter: 'blur(16px)',
				WebkitBackdropFilter: 'blur(16px)',
				boxShadow: isActive
					? '0 18px 44px rgba(99, 102, 241, 0.48)'
					: '0 8px 22px rgba(15, 23, 42, 0.32)',
				transition:
					'background 0.4s ease, color 0.4s ease, box-shadow 0.4s ease, border-color 0.4s ease',
				zIndex: 2,
				'&::before': {
					content: '""',
					position: 'absolute',
					inset: -1,
					borderRadius: 'inherit',
					background: haloGradient,
					opacity: isActive ? 0.55 : 0.18,
					transition: 'opacity 0.4s ease',
					zIndex: -2,
				},
				'&::after': {
					content: '""',
					position: 'absolute',
					inset: '24% -50%',
					borderRadius: '50%',
					background:
						'radial-gradient(circle at center, rgba(255, 255, 255, 0.55), rgba(255, 255, 255, 0))',
					opacity: isActive ? 0.7 : 0,
					transition: 'opacity 0.4s ease',
					zIndex: -1,
				},
				'& .MuiChip-label': {
					px: 0.75,
					fontWeight: 700,
					fontSize: '0.82rem',
				},
				'& .MuiChip-icon': {
					color: isActive ? '#f8fafc' : '#a5b4fc',
					fontSize: '1.2rem',
					transition: 'color 0.3s ease',
				},
				'&:focus-visible': {
					outline: '2px solid rgba(94, 234, 212, 0.8)',
					outlineOffset: 3,
				},
			};
		},
		[],
	);

	const scrollToSection = useCallback(
		(sectionId: string) => {
			if (typeof document === 'undefined') {
				return;
			}

			const target = document.querySelector(sectionId);

			if (target instanceof HTMLElement) {
				target.scrollIntoView({
					behavior: shouldReduceMotion ? 'auto' : 'smooth',
					block: 'start',
				});

				setActiveSection(sectionId.replace('#', ''));
				setIsMenuOpen(false);
			}
		},
		[shouldReduceMotion],
	);

	const updateLiquidIndicator = useCallback(
		(interpolationData: InterpolationDatum[], primarySection: string) => {
			if (shouldReduceMotion) {
				return;
			}

			const primaryPosition = navItemPositions[primarySection];
			if (!primaryPosition) {
				return;
			}

			const sortedData = interpolationData
				.filter((data) => data.visibilityRatio > 0)
				.sort((a, b) => b.visibilityRatio - a.visibilityRatio)
				.slice(0, 2);

			if (sortedData.length === 0) {
				return;
			}

			const [primary, secondary] = sortedData;

			let targetX = primaryPosition.x;
			let targetWidth = primaryPosition.width;

			if (secondary && secondary.visibilityRatio > 0.1) {
				const secondaryPosition = navItemPositions[secondary.section];

				if (secondaryPosition) {
					const interpolationStrength =
						secondary.visibilityRatio /
						(primary.visibilityRatio + secondary.visibilityRatio);

					const easedInterpolation = 1 - Math.pow(1 - interpolationStrength, 3);

					if (secondary.index > primary.index) {
						targetX =
							primaryPosition.x +
							(secondaryPosition.x - primaryPosition.x) * easedInterpolation * 0.3;
						targetWidth =
							primaryPosition.width +
							(secondaryPosition.width - primaryPosition.width +
								Math.abs(secondaryPosition.x - primaryPosition.x) * 0.5) *
								easedInterpolation;
					} else {
						targetX =
							secondaryPosition.x +
							(primaryPosition.x - secondaryPosition.x) * (1 - easedInterpolation * 0.3);
						targetWidth =
							secondaryPosition.width +
							(primaryPosition.width - secondaryPosition.width +
								Math.abs(primaryPosition.x - secondaryPosition.x) * 0.5) *
								(1 - easedInterpolation);
					}
				}
			}

			liquidX.set(targetX);
			liquidWidth.set(Math.max(targetWidth, 60));
			liquidOpacity.set(1);
		},
		[liquidOpacity, liquidWidth, liquidX, navItemPositions, shouldReduceMotion],
	);

	useEffect(() => {
		if (typeof window === 'undefined' || typeof document === 'undefined') {
			return;
		}

		const handleScroll = () => {
			const sections = navItems.map((item) => item.href.replace('#', ''));

			let currentSection = 'hero';
			let maxVisibleArea = 0;
			const interpolationData: InterpolationDatum[] = [];

			const viewportHeight = window.innerHeight;
			const scrollTop = window.scrollY;

			sections.forEach((section, index) => {
				const element = document.getElementById(section);

				if (!element) {
					return;
				}

				const { offsetTop, offsetHeight } = element;

				const visibleTop = Math.max(scrollTop, offsetTop);
				const visibleBottom = Math.min(
					scrollTop + viewportHeight,
					offsetTop + offsetHeight,
				);
				const visibleHeight = Math.max(0, visibleBottom - visibleTop);
				const visibilityRatio = visibleHeight / Math.min(offsetHeight, viewportHeight);

				interpolationData.push({ section, visibilityRatio, index });

				if (visibilityRatio > maxVisibleArea) {
					maxVisibleArea = visibilityRatio;
					currentSection = section;
				}
			});

			if (currentSection !== activeSection) {
				setActiveSection(currentSection);
			}

			updateLiquidIndicator(interpolationData, currentSection);
		};

		window.addEventListener('scroll', handleScroll);
		handleScroll();

		return () => {
			window.removeEventListener('scroll', handleScroll);
		};
	}, [activeSection, navItems, updateLiquidIndicator]);

	useEffect(() => {
		if (!shouldReduceMotion) {
			return;
		}

		if (typeof window === 'undefined' || typeof document === 'undefined') {
			return;
		}

		const handleScroll = () => {
			const sections = navItems.map((item) => item.href.replace('#', ''));
			const scrollPosition = window.scrollY + 100;

			sections.some((section) => {
				const element = document.getElementById(section);

				if (!element) {
					return false;
				}

				const { offsetTop, offsetHeight } = element;

				if (scrollPosition >= offsetTop && scrollPosition < offsetTop + offsetHeight) {
					setActiveSection(section);
					return true;
				}

				return false;
			});
		};

		window.addEventListener('scroll', handleScroll);

		return () => {
			window.removeEventListener('scroll', handleScroll);
		};
	}, [navItems, shouldReduceMotion]);

	useEffect(() => {
		if (typeof window === 'undefined') {
			return;
		}

		const measurePositions = () => {
			const navElement = navRef.current;

			if (!navElement) {
				return;
			}

			const parentRect = navElement.getBoundingClientRect();
			const navElements = navElement.querySelectorAll<HTMLElement>('[data-nav-item]');
			const positions: NavItemPositions = {};

			navElements.forEach((item) => {
				const section = item.getAttribute('data-nav-item');

				if (!section) {
					return;
				}

				const rect = item.getBoundingClientRect();

				positions[section] = {
					x: rect.left - parentRect.left,
					width: rect.width,
					height: rect.height,
				};
			});

			setNavItemPositions(positions);
		};

		measurePositions();
		window.addEventListener('resize', measurePositions);

		const timer = window.setTimeout(measurePositions, 100);

		return () => {
			window.removeEventListener('resize', measurePositions);
			window.clearTimeout(timer);
		};
	}, [navItems]);

	const containerVariants: Variants = {
		hidden: { opacity: 0, y: -20 },
		visible: {
			opacity: 1,
			y: 0,
			transition: {
				duration: 0.6,
				staggerChildren: 0.1,
				ease: 'easeOut',
			},
		},
	};

	const itemVariants: Variants = {
		hidden: { opacity: 0, y: -10 },
		visible: { opacity: 1, y: 0 },
	};

	const menuVariants: Variants = {
		closed: {
			opacity: 0,
			scale: 0.95,
			transition: { duration: 0.2, ease: 'easeIn' },
		},
		open: {
			opacity: 1,
			scale: 1,
			transition: {
				duration: 0.3,
				ease: 'easeOut',
				staggerChildren: 0.05,
				delayChildren: 0.1,
			},
		},
	};

	const mobileMenuItemVariants: Variants = {
		closed: { opacity: 0, x: -20 },
		open: { opacity: 1, x: 0 },
	};

	const navButtonVariants: Variants = {
		inactive: {
			scale: 1,
			y: 0,
			boxShadow: '0 6px 18px rgba(15, 23, 42, 0.32)',
			transition: { type: 'spring', stiffness: 320, damping: 32, mass: 1 },
		},
		hover: {
			scale: 1.05,
			y: -6,
			boxShadow: '0 16px 34px rgba(99, 102, 241, 0.46)',
			transition: { type: 'spring', stiffness: 420, damping: 32, mass: 1 },
		},
		active: {
			scale: 1.04,
			y: -4,
			boxShadow: '0 18px 40px rgba(99, 102, 241, 0.5)',
			transition: { type: 'spring', stiffness: 360, damping: 30, mass: 1 },
		},
		activeHover: {
			scale: 1.08,
			y: -8,
			boxShadow: '0 22px 50px rgba(99, 102, 241, 0.6)',
			transition: { type: 'spring', stiffness: 440, damping: 34, mass: 1 },
		},
	};

	const appBarOpacity = shouldReduceMotion ? 0.98 : trigger ? 0.95 : 0.82;

	return (
		<>
			<AppBar
				position="fixed"
				elevation={0}
				id="main-navbar"
				sx={{
					backgroundColor: 'transparent',
					boxShadow: 'none',
					borderBottom: '1px solid rgba(148, 163, 184, 0.18)',
					color: '#f8fafc',
					zIndex: 1100,
					transition: 'opacity 0.4s ease, transform 0.4s ease',
				}}
				style={{
					opacity: appBarOpacity,
				}}
			>
				<Box
					sx={{
						position: 'absolute',
						inset: 0,
						pointerEvents: 'none',
						overflow: 'hidden',
						zIndex: 0,
					}}
				>
					{canRenderGlass && (
						<Box
							sx={{
								position: 'absolute',
								inset: '-35% -15%',
								opacity: trigger ? 0.92 : 0.78,
								pointerEvents: 'none',
								filter: 'blur(4px)',
								transform: 'scale(1.05)',
							}}
						>
							<FluidGlass
								mode="bar"
								barProps={{
									scale: 0.22,
									thickness: 10,
									anisotropy: 0.05,
									chromaticAberration: 0.1,
									attenuationDistance: 0.5,
									attenuationColor: trigger ? '#0e7490' : '#6366f1',
									color: trigger ? '#38bdf8' : '#c7d2fe',
									transmission: 1,
									roughness: 0,
									ior: 1.2,
								}}
							>
								<NavbarGlassContent scrolled={trigger} />
							</FluidGlass>
						</Box>
					)}
					<Box
						sx={{
							position: 'absolute',
							inset: 0,
							pointerEvents: 'none',
							background: trigger
								? 'linear-gradient(135deg, rgba(30, 41, 59, 0.75) 0%, rgba(15, 23, 42, 0.65) 55%, rgba(14, 116, 144, 0.48) 100%)'
								: 'linear-gradient(135deg, rgba(30, 41, 59, 0.52) 0%, rgba(15, 23, 42, 0.38) 55%, rgba(99, 102, 241, 0.30) 100%)',
							backdropFilter: 'blur(20px)',
							WebkitBackdropFilter: 'blur(20px)',
						}}
					/>
				</Box>

				<Toolbar
					sx={{
						justifyContent: 'space-between',
						px: { xs: 2.5, md: 4 },
						py: 1,
						position: 'relative',
						zIndex: 2,
					}}
				>
					<motion.div
						variants={itemVariants}
						style={{ scale: shouldReduceMotion ? 1 : logoScale }}
						whileHover={shouldReduceMotion ? undefined : { scale: 1.05 }}
						whileTap={shouldReduceMotion ? undefined : { scale: 0.95 }}
					>
						<Box
							onClick={() => scrollToSection('#hero')}
							sx={{
								display: 'flex',
								alignItems: 'center',
								gap: 2,
								cursor: 'pointer',
								py: 1,
							}}
						>
							<Box
								sx={{
									width: 48,
									height: 48,
									borderRadius: '50%',
									background:
										'linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #22d3ee 100%)',
									display: 'flex',
									alignItems: 'center',
									justifyContent: 'center',
									fontSize: '1.5rem',
									fontWeight: 'bold',
									color: 'white',
									position: 'relative',
									'&::before': {
										content: '""',
										position: 'absolute',
										inset: -2,
										borderRadius: '50%',
										background: 'linear-gradient(135deg, #6366f1, #8b5cf6, #22d3ee)',
										zIndex: -1,
										opacity: 0.5,
									},
								}}
							>
								G
							</Box>
							{!isMobile && (
								<Box>
									<Box
										sx={{
											fontWeight: 600,
											fontSize: '1.25rem',
											background: 'linear-gradient(135deg, #6366f1 0%, #22d3ee 100%)',
											WebkitBackgroundClip: 'text',
											WebkitTextFillColor: 'transparent',
										}}
									>
										Gading Aditya Perdana
									</Box>
									<Box sx={{ fontSize: '0.875rem', color: '#94a3b8' }}>
										AI Researcher &amp; Engineer
									</Box>
								</Box>
							)}
						</Box>
					</motion.div>

					{!isMobileDevice && !isTabletDevice && (
						<motion.div
							ref={navRef}
							variants={containerVariants}
							initial="hidden"
							animate="visible"
							style={{ position: 'relative' }}
						>
							{!shouldReduceMotion && (
								<motion.div
									style={{
										position: 'absolute',
										top: 0,
										left: springX,
										width: springWidth,
										height: '100%',
										background:
											'linear-gradient(135deg, rgba(99, 102, 241, 0.32) 0%, rgba(14, 165, 233, 0.28) 50%, rgba(244, 114, 182, 0.24) 100%)',
										borderRadius: '999px',
										opacity: springOpacity,
										zIndex: 0,
										filter: 'blur(4px)',
										boxShadow:
											'0 12px 40px rgba(99, 102, 241, 0.22), inset 0 1px 0 rgba(255, 255, 255, 0.12)',
									}}
									transition={{ type: 'spring', stiffness: 200, damping: 25, mass: 1 }}
								/>
							)}

							<Box sx={{ display: 'flex', gap: 1.1, position: 'relative', zIndex: 1 }}>
								{navItems.map((item) => {
									const sectionKey = item.href.replace('#', '');
									const isActive = activeSection === sectionKey;
									const Icon = item.icon;

									return (
										<motion.div key={item.name} variants={itemVariants}>
											<motion.div
												data-nav-item={sectionKey}
												variants={navButtonVariants}
												initial="inactive"
												animate={isActive ? 'active' : 'inactive'}
												whileHover={shouldReduceMotion ? undefined : isActive ? 'activeHover' : 'hover'}
												whileTap={shouldReduceMotion ? undefined : { scale: 0.95 }}
												style={{
													display: 'inline-flex',
													borderRadius: '999px',
													position: 'relative',
													cursor: 'pointer',
												}}
											>
												<Chip
													icon={<Icon />}
													label={item.name}
													onClick={() => scrollToSection(item.href)}
													clickable
													component="button"
													sx={getNavChipStyles(isActive)}
													aria-current={isActive ? 'true' : undefined}
												/>
											</motion.div>
										</motion.div>
									);
								})}
							</Box>
						</motion.div>
					)}

					{(isMobileDevice || isTabletDevice) && (
						<IconButton
							onClick={() => setIsMenuOpen((prev) => !prev)}
							sx={{
								color: '#f8fafc',
								backgroundColor: 'rgba(15, 23, 42, 0.45)',
								borderRadius: '999px',
								transition: 'all 0.3s ease',
								padding: 1,
								'&:hover': {
									backgroundColor: 'rgba(99, 102, 241, 0.45)',
									transform: 'translateY(-2px) scale(1.05)',
									boxShadow: '0 12px 32px rgba(99, 102, 241, 0.35)',
								},
							}}
						>
							<motion.div
								animate={{ rotate: isMenuOpen ? 180 : 0 }}
								transition={{ duration: 0.3 }}
							>
								{isMenuOpen ? <CloseIcon /> : <MenuIcon />}
							</motion.div>
						</IconButton>
					)}
				</Toolbar>

				<motion.div
					style={{
						position: 'absolute',
						bottom: 0,
						left: 0,
						right: 0,
						height: 3,
						background:
							'linear-gradient(90deg, rgba(56, 189, 248, 0.92) 0%, rgba(99, 102, 241, 0.92) 55%, rgba(244, 114, 182, 0.9) 100%)',
						boxShadow: '0 0 24px rgba(56, 189, 248, 0.45)',
						transformOrigin: 'left',
						scaleX: shouldReduceMotion ? 0.25 : scrollYProgress,
					}}
				/>
			</AppBar>

			<AnimatePresence>
				{isMenuOpen && (isMobileDevice || isTabletDevice) && (
					<>
						<Backdrop open={isMenuOpen} onClick={() => setIsMenuOpen(false)} sx={{ zIndex: 1200 }} />
						<motion.div
							variants={menuVariants}
							initial="closed"
							animate="open"
							exit="closed"
							style={{
								position: 'fixed',
								top: '80px',
								right: '16px',
								left: isMobileDevice ? '16px' : 'auto',
								zIndex: 1300,
								width: isMobileDevice ? 'auto' : '320px',
								maxWidth: isMobileDevice ? 'calc(100vw - 32px)' : '320px',
								maxHeight: '80vh',
								overflowY: 'auto',
							}}
						>
							<Box
								sx={{
									background: 'rgba(10, 10, 10, 0.95)',
									border: '1px solid rgba(255, 255, 255, 0.1)',
									borderRadius: 3,
									p: 3,
									display: 'flex',
									flexDirection: 'column',
									gap: 2,
								}}
							>
								<Box sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}>
									{navItems.map((item) => {
										const isActive = activeSection === item.href.replace('#', '');
										const Icon = item.icon;

										return (
											<motion.div key={item.name} variants={mobileMenuItemVariants}>
												<Chip
													icon={<Icon />}
													label={item.name}
													onClick={() => scrollToSection(item.href)}
													variant={isActive ? 'filled' : 'outlined'}
													sx={{
														width: '100%',
														justifyContent: 'flex-start',
														py: 1.5,
														cursor: 'pointer',
														color: '#ffffff',
														borderColor: '#6366f1',
														backgroundColor: isActive ? '#6366f1' : 'transparent',
														transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
														'&:hover': {
															transform: 'translateX(8px)',
															boxShadow: '0 4px 20px rgba(99, 102, 241, 0.4)',
															backgroundColor: '#6366f1',
														},
														'& .MuiChip-icon': {
															color: isActive ? '#ffffff' : '#6366f1',
														},
														'&:hover .MuiChip-icon': {
															color: '#ffffff',
														},
													}}
												/>
											</motion.div>
										);
									})}
								</Box>

								<Box sx={{ mt: 2, pt: 2, borderTop: '1px solid rgba(255, 255, 255, 0.1)' }}>
									<motion.div variants={mobileMenuItemVariants}>
										<Chip
											icon={<Description />}
											label="View Resume"
											onClick={() => {
												const newWindow = window.open(resumePDF, '_blank');

												if (newWindow) {
													newWindow.addEventListener('load', () => {
														const style = newWindow.document.createElement('style');
														style.textContent = `
															.resume-download-btn {
																position: fixed;
																top: 20px;
																right: 20px;
																z-index: 9999;
																background: #6366f1;
																color: white;
																border: none;
																padding: 12px 24px;
																border-radius: 8px;
																cursor: pointer;
																font-weight: 600;
																box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
																transition: all 0.3s ease;
															}
															.resume-download-btn:hover {
																background: #4f46e5;
																transform: translateY(-2px);
																box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
															}
														`;
														newWindow.document.head.appendChild(style);

														const downloadButton = newWindow.document.createElement('button');
														downloadButton.textContent = 'ðŸ“¥ Download Resume';
														downloadButton.className = 'resume-download-btn';
														downloadButton.onclick = () => {
															const link = newWindow.document.createElement('a');
															link.href = resumePDF;
															link.download = 'Gading_Aditya_Perdana_Resume.pdf';
															link.click();
														};
														newWindow.document.body.appendChild(downloadButton);
													});
												}

												setIsMenuOpen(false);
											}}
											sx={{
												width: '100%',
												justifyContent: 'flex-start',
												py: 1.5,
												cursor: 'pointer',
												color: '#ffffff',
												borderColor: '#22c55e',
												backgroundColor: 'transparent',
												transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
												'&:hover': {
													transform: 'translateX(8px)',
													boxShadow: '0 4px 20px rgba(34, 197, 94, 0.4)',
													backgroundColor: '#22c55e',
												},
												'& .MuiChip-icon': {
													color: '#22c55e',
												},
												'&:hover .MuiChip-icon': {
													color: '#ffffff',
												},
											}}
										/>
									</motion.div>
								</Box>
							</Box>
						</motion.div>
					</>
				)}
			</AnimatePresence>

			{!isMenuOpen && (
				<Zoom in={trigger}>
					<motion.div
						whileHover={shouldReduceMotion ? undefined : { scale: 1.1, rotate: 5 }}
						whileTap={shouldReduceMotion ? undefined : { scale: 0.9 }}
					>
						<Fab
							onClick={() => scrollToSection('#contact')}
							sx={{
								position: 'fixed',
								bottom: 32,
								right: 32,
								zIndex: 1000,
								backgroundColor: '#6366f1',
								color: '#ffffff',
								'&:hover': {
									backgroundColor: '#4f46e5',
									boxShadow: '0 8px 25px rgba(99, 102, 241, 0.5)',
								},
							}}
						>
							<ContactMail />
						</Fab>
					</motion.div>
				</Zoom>
			)}
		</>
	);
};

const ModernNavbar = memo(ModernNavbarComponent);
ModernNavbar.displayName = 'ModernNavbar';

export default ModernNavbar;